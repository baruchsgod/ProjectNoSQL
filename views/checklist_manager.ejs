<!DOCTYPE html>
<html lang="en" dir="ltr">

<head>
  <meta charset="utf-8">
  <title>Home Sticky</title>
  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link href="https://fonts.googleapis.com/css2?family=Modak&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
  <link rel="stylesheet" href="../../css/styles.css">
  <link rel="stylesheet" href="../../css/checklist.css">
</head>

<body>
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <a class="navbar-brand nav-pad" href="/home/<%= user_checklist %>">
      <img src="../../images/sticky.png" alt="sticky" class="homeSticky">
    </a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarTogglerDemo02" aria-controls="navbarTogglerDemo02" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navbarTogglerDemo02">


      <ul class="nav navbar-nav navbar-left">
        <li class="nav-item active">
          <a class="nav-link" href="/home/<%= user_checklist %>">Home</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#">Reports</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#" tabindex="-1" aria-disabled="true">LogOut</a>
        </li>
      </ul>
    </div>
  </nav>
  <div class="container contain_margin">


<div class="card text-center">
  <div class="card-header header_color">
    <%= name%>
    <p class="first_para">Due Date: <%= due_da%></p>
  </div>


  <% if(activity.length>0){ %>

  <% for(i=0;i<activity.length;i++){ %>
  <form id="form<%= i %>" action="/checklist/delete" method="post">
    <div class="card-body top_border">

      <input type="checkbox" onClick="deletePost(this)" name="delete_item" value=<%= i %>>
      <input type="hidden" name="input_check" value=<%= id %>>
      <p class="item"><%= activity[i] %></p>
    </div>
  </form>

  <% } %>

  <% }else{ %>
  <p>No items found for this checklist</p>
  <% } %>


  <div class="card-footer text-muted">

    <div class="comment_section" onclick="toggle()">
      <% if(comments!=null){ %>
        <p class="add_comment">Comments(<%= comments.length %>)</p>
      <% }else{ %>
        <p class="add_comment">Comments(0)</p>
      <% } %>

      <button class="btn btn-lg btn-warning adding" type="submit" data-toggle="modal" data-target="#myModal" name="addList">
        <p>+</p>
      </button>
    </div>

    <div class="post_comment" id="comment_toggle" style="display:none">
      <form id="comment_form" action="/comment/post" name="postComment" method="POST">
       <textarea class="form-control width_adjust" name="post_body"></textarea>
       <input type="hidden" name="id_task_comment" value=<%= object_id %>>
       <input type="hidden" name="username_task" value=<%= user_checklist%>>
       <input class="btn btn-lg btn-info" type="submit" name="postComments" value="Add">
       <div class="added_comments">
         <% if(comments!=null){ %>
           <% for(i=0;i<comments.length;i++){ %>
             <div class="actual_comment">
               <p class="list_comments"><%= comments[i].id_user %> is saying: </p>
               <p><%= comments[i].body %></p>
               <p><%= comments[i].fecha %></p>
             </div>
           <% } %>
         <% }else{ %>
           <p class="null_comment">No comments to show</p>
         <% } %>
       </div>
     </form>
    </div>

    <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h4 class="modal-title" id="myModalLabel">Add a task!</h4>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>

          </div>

          <div class="modal-body">
            <p>This items will be added into your checklist <%= name %></p>

            <form class="profile_post" action="/checklist/add" method="POST" onsubmit="return notEmpty()">
              <div class="form-group">
                <textarea id="post_body" class="form-control" name="post_body"></textarea>
                <input type="hidden" name="id_list" value=<%= id %>>

              </div>

          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            <input type="hidden" name="object_id" value=<%= object_id%>>
            <input type="hidden" name="user_manager" value=<%= user_checklist%>>
            <button type="submit" class="btn btn-warning" name="submit_post" id="submit_post_button" value="Manager">Create</button>

          </div>

          </form>


        </div>
      </div>
    </div>

    <script>
      function notEmpty() {
        var body = document.getElementById('post_body').value;
        var len = body.length;

        if (len != 0) {
          return true;
        } else {
          return false;
        }


      }
    </script>
    <script>
      function deletePost(post) {
        var id = post.value;
        var forms = "#form"+id;
        var whole_form = $(forms);
        bootbox.confirm("Are you sure you want to delete this task?", function(result) {

          if (result) {

            whole_form.submit();

          } else {

          }
        })
      }

      function toggle(){

        var post_id = document.getElementById("comment_toggle");
        var target = $(event.target);
        if(!target.is("button") && !target.is("p")){
          if(post_id.style.display === "block"){
            post_id.style.display = "none";
          }else{
            post_id.style.display = "block";
          }
        }

      }
    </script>


    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootbox.js/5.4.0/bootbox.min.js"></script>

    </body>

    </html>
